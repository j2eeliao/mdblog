
# 安全机制

数据安全性是云存储服务的重中之重。云存储的安全机制主要需要考虑以下几个因素：

- **签名**：如何判断该请求方是否合法，且对目标空间有相应的访问权限。
- **HTTPS**： 因为服务的访问协议同时支持 HTTP 和 HTTPS，服务端需要判断收到的请求是否经过篡改。
- **管理安全更重要**：相比上传新资源，覆盖文件或删除已有资源拥有更高的风险。因此对上传或修改动作，需要确认请求方是否拥有修改或删除的权限。

在使用七牛云存储服务的过程中，需要考虑安全机制的场景主要有如下几种：

- 上传资源  [上传凭证](https://developer.qiniu.com/kodo/manual/1208/upload-token)
- 访问资源 [下载凭证](https://developer.qiniu.com/kodo/manual/1202/download-token)
- 管理和修改资源  [管理凭证](https://developer.qiniu.com/kodo/manual/1201/access-token)

>因为凭证的生成需要用到 ``SecretKey``，因此该**生成动作不应在不受信任的环境中进行**。
需要注意的是，开发者绝不能将密钥包含在分发给最终用户的程序中，无论是包含在配置文件中还是二进制文件中都会带来非常大的密钥泄漏风险。


推荐的模型如下所示：

![](https://ok0kc3ycj.qnssl.com/kodo-image/png/token.png)


## 防盗链

下载还有一种常见的场景，即公开资源的防盗链，例如 **禁止特定来源域名的访问，禁止非浏览器发起的访问** 等。

我们可以通过 HTTP 协议支持的 Referer 机制即 ``HTTP Referer`` 来进行相应的来源识别和管理。

防盗链是一个系统设置，不影响开发工作。如发现有盗链情况，开发者可在七牛开发者平台里的 融合CDN加速 中的 高级配置 进行设置。

## 跨域访问

出于安全的考虑，Web 浏览器从很早之前就定下同域安全策略的标准，默认情况下同一域名下的页面只能向同域（包括 CNAME 域名、端口）下的 URL 发送所有类型的 HTTP 请求。而向不同域的地址发送非 GET 请求时，默认情况下只能返回同域安全策略错误。

对此，在发起上传或下载请求的时候，七牛的服务会返回相应的支持跨域的 Header：

## 密钥及其管理

密钥（AccessKey/SecretKey）用于以上几种凭证的生成。以 ``SecretKey`` 为参数，配合适当的签名算法，可以得到原始信息的数字签名，防止内容在传递过程中被伪造或篡改。

密钥通常是成对创建和使用，包含一个 AccessKey 和一个 SecretKey。其中 AccessKey 会在传输中包含，而用户必须保管好 SecretKey 不在网络上传输以防止被窃取。若 SecretKey 被恶意第三方窃取，可能导致非常严重的数据泄漏风险。因此，如发现 SecretKey 被非法使用，管理员应第一时间在七牛开发者平台的 [密钥管理]() 中 **更换密钥**。


## 上传策略

https://developer.qiniu.com/kodo/manual/1206/put-policy

>上传策略是资源上传时附带的一组配置设定。通过这组配置信息，七牛云存储可以了解用户上传的需求：它将上传什么资源，上传到哪个空间，上传结果是回调通知还是使用重定向跳转，是否需要设置反馈信息的内容，以及授权上传的截止时间等等。
